(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6616],{25987:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[handle]",function(){return i(96902)}])},81571:function(e,t,i){"use strict";i.r(t);let n={kind:"InlineDataFragment",name:"optimisticChat_createOptimisticChat_bot"};n.hash="8a5f6fa386ed45339f328d023b51a418",t.default=n},55554:function(e,t,i){"use strict";i.d(t,{F:function(){return useCreateOptimisticChat},t:function(){return useOptimisticChat}});var n=i(41143),a=i.n(n),s=i(67294),c=i(22578),o=i(44311),r=i(89083),d=i(8611),u=i(64076);let gen_random_number=()=>Math.floor(1e9*Math.random()),getOptimisticChatId=e=>"OPTIMISTIC_CHAT_".concat(e),getOptimisticMessagesConnectionId=e=>o.ConnectionHandler.getConnectionID(e,"ChatMessagesView_chat_messagesConnection"),getOptimisticMessagePageInfoId=e=>"".concat(e,"_MESSAGE_PAGE_INFO"),getOptimisticMemberPageInfoId=e=>"".concat(e,"_MEMBER_PAGE_INFO"),getOptimisticIntroMessageEdgeId=e=>"".concat(e,"_INTRO_MESSAGE_EDGE"),getOptimisticMembersConnectionId=e=>"".concat(e,"_MEMBERS_CONNECTION"),getOptimisticBotMemberEdgeId=e=>"".concat(e,"_BOT_MEMBER_EDGE"),useOptimisticChat=(e,t)=>{let i=useCreateOptimisticChat(e),[n]=(0,s.useState)(()=>t||i());return n},useCreateOptimisticChat=e=>{let t=(0,c.useRelayEnvironment)();return(0,s.useCallback)(()=>createOptimisticChat({environment:t,bot:e}),[t,e])},createOptimisticChat=e=>{let t,n,{environment:s,bot:c}=e;return(0,o.commitLocalUpdate)(s,e=>{let{id:s,nickname:m,introduction:l,isTrustedBot:g,...I}=(0,o.readInlineData)(i(81571),c),C=e.get(s);for(a()(C,"botRecord is ".concat(C));!t||e.get(t);)t=getOptimisticChatId(n=gen_random_number());let _=e.create(t,"Chat");_.setValue(t,"id"),_.setValue(t,"chatId"),_.setValue("","chatCode"),_.setValue(!0,"isOptimistic"),_.setValue(m,"defaultBotNickname"),_.setValue(1e3*Date.now(),"creationTime"),_.setValue(1e3*Date.now(),"lastInteractionTime"),_.setValue(null,"title"),_.setValue(!0,"shouldShowDisclaimer"),_.setValue(1e3*Date.now(),"creationTime"),_.setValue(!C.getValue("isTrustedBot"),"membersIncludeUntrustedBot"),_.setValue(!g,"membersIncludeUntrustedBot"),_.setLinkedRecord(C,"defaultBotObject");let h=l?(0,u.dS)(e,{text:l,state:d.Z.complete,bot:I,contentType:r.Z.text_markdown}):null,p=l?[h]:[],O=p.map(i=>{a()(t,"chatId is ".concat(t));let n=e.create(getOptimisticIntroMessageEdgeId(t),"MessageEdge");return n.setLinkedRecord(i,"node"),n}),E=e.create(getOptimisticMessagePageInfoId(t),"PageInfo");E.setValue(!1,"hasPreviousPage"),E.setValue(h?h.getDataID():null,"startCursor");let M=e.create(getOptimisticMessagesConnectionId(t),"MessagesConnection");M.setLinkedRecords(O,"edges"),M.setLinkedRecord(E,"pageInfo"),_.setLinkedRecord(M,"messagesConnection",{last:5}),_.setLinkedRecord(M,"__ChatMessagesView_chat_messagesConnection_connection");let f=[e.create(getOptimisticBotMemberEdgeId(t),"ChatMemberEdge")];f[0].setLinkedRecord(C,"node");let b=e.create(getOptimisticMemberPageInfoId(t),"PageInfo");b.setValue(!1,"hasNextPage"),b.setValue(f[0].getDataID(),"endCursor");let k=e.create(getOptimisticMembersConnectionId(t),"ChatMemberConnection");k.setLinkedRecords(f,"edges"),k.setLinkedRecord(b,"pageInfo"),_.setLinkedRecord(k,"membersConnection"),e.getRoot().setLinkedRecord(_,"optimisticChat",{optimisticChatId:t})}),a()(t,"chatId is ".concat(t)),a()(n,"chatIdNumber is ".concat(n)),t}}},function(e){e.O(0,[1265,1664,5675,6835,3974,8039,6793,1044,5566,9129,333,3825,2870,7283,6698,9535,549,6169,6902,9774,2888,179],function(){return e(e.s=25987)}),_N_E=e.O()}]);